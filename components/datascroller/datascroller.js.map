{"version":3,"file":"datascroller.js","sourceRoot":"","sources":["datascroller.ts"],"names":[],"mappings":"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","sourcesContent":["import {NgModule,Component,ElementRef,AfterViewInit,AfterContentInit,OnDestroy,Input,Output,Renderer,ViewChild,EventEmitter,ContentChild,ContentChildren,QueryList,TemplateRef} from '@angular/core';\r\nimport {CommonModule} from '@angular/common';\r\nimport {Header,Footer,PrimeTemplate,SharedModule} from '../common/shared';\r\nimport {DomHandler} from '../dom/domhandler';\r\n\r\n@Component({\r\n    selector: 'p-dataScroller',\r\n    template: `\r\n    <div [ngClass]=\"{'ui-datascroller ui-widget': true, 'ui-datascroller-inline': inline}\" [ngStyle]=\"style\" [class]=\"styleClass\">\r\n        <div class=\"ui-datascroller-header ui-widget-header ui-corner-top\" *ngIf=\"header\">\r\n            <ng-content select=\"p-header\"></ng-content>\r\n        </div>\r\n        <div #content class=\"ui-datascroller-content ui-widget-content\" [ngStyle]=\"{'max-height': scrollHeight}\">\r\n            <ul class=\"ui-datascroller-list\">\r\n                <li *ngFor=\"let item of dataToRender\">\r\n                    <ng-template [pTemplateWrapper]=\"itemTemplate\" [item]=\"item\"></ng-template>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <div class=\"ui-datascroller-footer ui-widget-header ui-corner-bottom\" *ngIf=\"footer\">\r\n            <ng-content select=\"p-footer\"></ng-content>\r\n        </div>\r\n    </div>\r\n    `,\r\n    providers: [DomHandler]\r\n})\r\nexport class DataScroller implements AfterViewInit,OnDestroy {\r\n\r\n    @Input() rows: number;\r\n\r\n    @Input() lazy: boolean;\r\n    \r\n    @Output() onLazyLoad: EventEmitter<any> = new EventEmitter();\r\n\r\n    @Input() style: any;\r\n\r\n    @Input() styleClass: string;\r\n    \r\n    @Input() buffer: number = 0.9;\r\n    \r\n    @Input() inline: boolean;\r\n    \r\n    @Input() scrollHeight: any;\r\n    \r\n    @Input() loader: any;\r\n    \r\n    @ViewChild('content') contentViewChild: ElementRef;\r\n        \r\n    @ContentChild(Header) header;\r\n\r\n    @ContentChild(Footer) footer;\r\n    \r\n    @ContentChildren(PrimeTemplate) templates: QueryList<any>;\r\n    \r\n    public _value: any[];\r\n    \r\n    public itemTemplate: TemplateRef<any>;\r\n\r\n    public dataToRender: any[] = [];\r\n\r\n    public first: number = 0;\r\n    \r\n    scrollFunction: any;\r\n    \r\n    contentElement: HTMLDivElement;\r\n\r\n    constructor(public el: ElementRef, public renderer: Renderer, public domHandler: DomHandler) {}\r\n\r\n    ngAfterViewInit() {\r\n        if(this.lazy) {\r\n            this.load();\r\n        }\r\n        \r\n        if(this.loader) {\r\n            this.scrollFunction = this.renderer.listen(this.loader, 'click', () => {\r\n                this.load();\r\n            });\r\n        }\r\n        else {\r\n            this.bindScrollListener();\r\n        }\r\n    }\r\n    \r\n    ngAfterContentInit() {\r\n        this.templates.forEach((item) => {\r\n            switch(item.getType()) {\r\n                case 'item':\r\n                    this.itemTemplate = item.template;\r\n                break;\r\n                \r\n                default:\r\n                    this.itemTemplate = item.template;\r\n                break;\r\n            }\r\n        });\r\n    }\r\n    \r\n    @Input() get value(): any[] {\r\n        return this._value;\r\n    }\r\n\r\n    set value(val:any[]) {\r\n        this._value = val;\r\n        this.handleDataChange();\r\n    }\r\n    \r\n    handleDataChange() {\r\n        if(this.lazy)\r\n            this.dataToRender = this.value;\r\n        else\r\n            this.load();\r\n    }\r\n        \r\n    load() {\r\n        if(this.lazy) {\r\n            this.onLazyLoad.emit({\r\n                first: this.first,\r\n                rows: this.rows\r\n            });\r\n            \r\n            this.first = this.first + this.rows;\r\n        }\r\n        else {\r\n            if(this.value) {\r\n                for(let i = this.first; i < (this.first + this.rows); i++) {\r\n                    if(i >= this.value.length) {\r\n                        break;\r\n                    }\r\n\r\n                    this.dataToRender.push(this.value[i]);\r\n                }\r\n                \r\n                this.first = this.first + this.rows;\r\n            }\r\n        }\r\n    }\r\n     \r\n    reset() {\r\n        this.first = 0;\r\n        this.dataToRender = [];\r\n        this.load();\r\n    }\r\n\r\n    isEmpty() {\r\n        return !this.dataToRender||(this.dataToRender.length == 0);\r\n    }\r\n    \r\n    createLazyLoadMetadata(): any {\r\n        return {\r\n            first: this.first,\r\n            rows: this.rows\r\n        };\r\n    }\r\n    \r\n    bindScrollListener() {\r\n        if(this.inline) {\r\n            this.contentElement = this.contentViewChild.nativeElement;\r\n            \r\n            this.scrollFunction = this.renderer.listen(this.contentElement, 'scroll', () => {\r\n                let scrollTop = this.contentElement.scrollTop;\r\n                let scrollHeight = this.contentElement.scrollHeight;\r\n                let viewportHeight = this.contentElement.clientHeight;\r\n\r\n                if((scrollTop >= ((scrollHeight * this.buffer) - (viewportHeight)))) {\r\n                    this.load();\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            this.scrollFunction = this.renderer.listenGlobal('window', 'scroll', () => {\r\n                let docBody = document.body;\r\n                let docElement = document.documentElement;\r\n                let scrollTop = (window.pageYOffset||document.documentElement.scrollTop);\r\n                let winHeight = docElement.clientHeight;\r\n                let docHeight = Math.max(docBody.scrollHeight, docBody.offsetHeight, winHeight, docElement.scrollHeight, docElement.offsetHeight);\r\n                            \r\n                if(scrollTop >= ((docHeight * this.buffer) - winHeight)) {\r\n                    this.load();\r\n                }\r\n            });\r\n        }\r\n        \r\n    }\r\n    \r\n    ngOnDestroy() {\r\n        //unbind\r\n        if(this.scrollFunction) {\r\n            this.scrollFunction();\r\n            this.contentElement = null;\r\n        }\r\n    }\r\n}\r\n\r\n@NgModule({\r\n    imports: [CommonModule,SharedModule],\r\n    exports: [DataScroller,SharedModule],\r\n    declarations: [DataScroller]\r\n})\r\nexport class DataScrollerModule { }\r\n\r\n"]}